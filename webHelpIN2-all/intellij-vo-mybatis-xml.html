<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF" data-link-color="#EB3F2F"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="built-on" content="2024-12-05T13:00:39.0764558"><title>⚽ VO 및 Mybatis XML 자동 생성 | RUN:DEVEL:RUN</title><script type="application/json" id="virtual-toc-data">[{"id":"-pc3pdk_4","level":0,"title":"✋ 들어가며","anchor":"#-pc3pdk_4"},{"id":"database","level":0,"title":"💾 Database 설정 및 연결","anchor":"#database"},{"id":"groovy-script","level":0,"title":"📝 Groovy Script 작성","anchor":"#groovy-script"},{"id":"-pc3pdk_7","level":0,"title":"💿 실행 및 결과","anchor":"#-pc3pdk_7"},{"id":"-pc3pdk_8","level":0,"title":"👋 마치며","anchor":"#-pc3pdk_8"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b518/app.css" rel="stylesheet"><link href="static/custom.css" rel="stylesheet"><link rel="icon" type="image/x-icon" sizes="16x16" href="YT-Wiki/favicon.ico"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="⚽ VO 및 Mybatis XML 자동 생성 | RUN:DEVEL:RUN"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="RUN:DEVEL:RUN Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://rundevelrun.6developer.com/intellij-vo-mybatis-xml.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="⚽ VO 및 Mybatis XML 자동 생성 | RUN:DEVEL:RUN"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "https://rundevelrun.6developer.com/intellij-vo-mybatis-xml.html#webpage",
    "url": "https://rundevelrun.6developer.com/intellij-vo-mybatis-xml.html",
    "name": "⚽ VO 및 Mybatis XML 자동 생성 | RUN:DEVEL:RUN",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "https://rundevelrun.6developer.com/#website",
    "url": "https://rundevelrun.6developer.com/",
    "name": "RUN:DEVEL:RUN Help"
}</script><!-- End Schema.org --><meta name="naver-site-verification" content="3f4e19dac0ab79636f9cd1eb3ce9f9278acaf219" />
<meta name="description" content="Software Architecture, Developer, 2013~">
<meta name="twitter:description" content="Software Architecture, Developer, 2013~">
<meta property="og:description" content="Software Architecture, Developer, 2013~"></head><body data-id="intellij-vo-mybatis-xml" data-main-title="⚽ VO 및 Mybatis XML 자동 생성" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Tools.md|Tools///IntelliJ.md|IntelliJ"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>RUN:DEVEL:RUN  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="intellij-vo-mybatis-xml" id="intellij-vo-mybatis-xml.md">⚽ VO 및 Mybatis XML 자동 생성</h1><aside class="prompt" data-type="tip" data-title="" id="-pc3pdk_3"><p id="-pc3pdk_9"><span class="emphasis" id="-pc3pdk_12"><span class="control" id="-pc3pdk_13">테스트 환경</span></span></p><p id="-pc3pdk_10">IntelliJ IDEA 2024.3 (Ultimate Edition)</p><p id="-pc3pdk_11">PostgreSQL 16.1 (Amazon Aurora)</p></aside><section class="chapter"><h2 id="-pc3pdk_4" data-toc="-pc3pdk_4">✋ 들어가며</h2><p id="-pc3pdk_14">데이터베이스에 생성되어있는 테이블을 기반으로 VO(DTO)를 생성하고 매번 작성해야하는 Mybatis 기반의 쿼리를 자동으로 생성할 수 없을까?</p><p id="-pc3pdk_15">고민하는 중에 인텔리제이와 약간의 Groovy 기반의 코딩을 이용하는 좋은 방법이 생겼다. 테스트 환경은 Ultimate Edition이지만 Community Edition도 가능하다.</p></section><section class="chapter"><h2 id="database" data-toc="database">💾 Database 설정 및 연결</h2><section class="chapter"><h3 id="database-data-source-postgresql" data-toc="database-data-source-postgresql"><span class="emphasis" id="-pc3pdk_20"><span class="control" id="-pc3pdk_21">Database ➡ <kbd class="keystroke" id="-pc3pdk_22" data-bypass="true"><span class="keystroke__value"> + </span></kbd> ➡ Data Source ➡ PostgreSQL</span></span></h3><ul class="list _bullet" id="-pc3pdk_19"><li class="list__item" id="-pc3pdk_23"><p>테스트 환경은 PostgreSQL이지만 지원하는 Data Source라면 모두 사용 가능하다. </p><figure id="-pc3pdk_24"><img alt="20241205 100506" src="YT-Wiki/20241205_100506.png" title="20241205 100506" width="634" height="811"></figure></li></ul></section><section class="chapter"><h3 id="postgresql" data-toc="postgresql"><span class="emphasis" id="-pc3pdk_27"><span class="control" id="-pc3pdk_28">PostgreSQL 연결</span></span></h3><ol class="list _decimal" id="-pc3pdk_26" type="1"><li class="list__item" id="-pc3pdk_29"><p id="-pc3pdk_31">PostgreSQL의 Host, User 등 접속 정보를 입력하고 OK 버튼을 클릭한다. <figure id="-pc3pdk_32"><img alt="20241205 101046" src="YT-Wiki/20241205_101046.png" title="20241205 101046" width="802" height="685"></figure></p></li><li class="list__item" id="-pc3pdk_30"><p id="-pc3pdk_33">연결되면 Database 탭에서 테이블 정보를 확인 할 수 있다. <figure id="-pc3pdk_34"><img alt="20241205 101236" src="YT-Wiki/20241205_101236.png" title="20241205 101236" width="399" height="282"></figure></p></li></ol></section></section><section class="chapter"><h2 id="groovy-script" data-toc="groovy-script">📝 Groovy Script 작성</h2><section class="chapter"><h3 id="-pc3pdk_35" data-toc="-pc3pdk_35"><span class="emphasis" id="-pc3pdk_39"><span class="control" id="-pc3pdk_40">스크립트 파일 생성</span></span></h3><ol class="list _decimal" id="-pc3pdk_38" type="1"><li class="list__item" id="-pc3pdk_41"><p>데이터베이스 연결이 완료되면 Project 탭에서 아래와 같은 내용을 확인 할 수 있다.</p></li><li class="list__item" id="-pc3pdk_42"><p><span class="emphasis" id="-pc3pdk_43">Generate POJOs.groovy</span> 파일을 복사해서 새로운 이름으로 만들어준다. </p><figure id="-pc3pdk_44"><img alt="20241205 101358" src="YT-Wiki/20241205_101358.png" title="20241205 101358" width="441" height="337"></figure></li></ol></section><section class="chapter"><h3 id="-pc3pdk_36" data-toc="-pc3pdk_36"><span class="emphasis" id="-pc3pdk_48"><span class="control" id="-pc3pdk_49">스크립트 수정</span></span></h3><ol class="list _decimal" id="-pc3pdk_46" type="1"><li class="list__item" id="-pc3pdk_50"><p>VO 파일에 <span class="emphasis" id="-pc3pdk_53">lombok</span>, <span class="emphasis" id="-pc3pdk_54">Swagger</span> 등을 적용하기 위해서 기본 파일을 수정 했다.</p></li><li class="list__item" id="-pc3pdk_51"><p>그리고 Mybatis 기반의 XML 쿼리까지 생성해주길 원하기 때문에 해당 부분을 추가 작성.</p></li><li class="list__item" id="-pc3pdk_52"><p>소스 전문</p></li></ol><div class="code-block" data-lang="groovy">
import com.intellij.database.model.DasTable
import com.intellij.database.util.Case
import com.intellij.database.util.DasUtil

/*
 * Available context bindings:
 *   SELECTION   Iterable&lt;DasObject&gt;
 *   PROJECT     project
 *   FILES       files helper
 */
packageName = &quot;_packageName_;&quot;
typeMapping = [
        (~/(?i)int/)                      : &quot;int&quot;,
        (~/(?i)float|double|decimal|real/): &quot;double&quot;,
        (~/(?i)datetime|timestamp/)       : &quot;String&quot;,
        (~/(?i)date/)                     : &quot;String&quot;,
        (~/(?i)time/)                     : &quot;String&quot;,
        (~/(?i)/)                         : &quot;String&quot;
]

FILES.chooseDirectoryAndSave(&quot;Choose directory&quot;, &quot;Choose where to store generated files&quot;) { dir -&gt;
    SELECTION.filter { it instanceof DasTable }.each { generateVo(it, dir) }
    SELECTION.filter { it instanceof DasTable }.each { generateSql(it, dir) }
}

def generateVo(table, dir) {
    def className = javaName(table.getName(), true)
    def fields = calcFields(table)
    def folderName = &quot;${dir}/model&quot;
    def folder = new File(folderName)
    if (!folder.exists()) {
        folder.mkdirs()
    }
    new File(folderName, className + &quot;.java&quot;).withPrintWriter { out -&gt; generateVo(out, className, fields) }
}

def generateSql(table, dir) {
    def camelClassName = javaName(table.getName(), true)
    def className = table.getName()
    def fields = calcFields(table)
    def folderName = &quot;${dir}/sql&quot;
    def folder = new File(folderName)
    if (!folder.exists()) {
        folder.mkdirs()
    }
    new File(folder, className + &quot;.xml&quot;).withPrintWriter { out -&gt; generateSql(out, camelClassName, className, fields) }
}

def generateVo(out, className, fields) {
    out.println &quot;package $packageName&quot;
    out.println &quot;&quot;
    out.println &quot;import lombok.*;&quot;
    out.println &quot;import com.fasterxml.jackson.annotation.JsonInclude;&quot;
    out.println &quot;import io.swagger.v3.oas.annotations.media.Schema;&quot;
    out.println &quot;&quot;
    out.println &quot;@AllArgsConstructor(access = AccessLevel.PRIVATE)&quot;
    out.println &quot;@NoArgsConstructor&quot;
    out.println &quot;@Data&quot;
    out.println &quot;@Builder&quot;
    out.println &quot;@JsonInclude(JsonInclude.Include.NON_NULL)&quot;
    out.println &quot;public class $className {&quot;
    out.println &quot;&quot;
    fields.each() {
        if (it.annos != &quot;&quot;) out.println &quot;  ${it.annos}&quot;
        out.println &quot;\t@Schema(description = \&quot;${it.comment}\&quot;, example = \&quot;${it.comment}\&quot;)&quot;
        out.println &quot;\tprivate ${it.type} ${it.camelName};&quot;
        out.println &quot;&quot;
    }
    out.println &quot;}&quot;
}

def generateSql(out, camelClassName, className, fields) {
    out.println '&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;'
    out.println '&lt;!DOCTYPE mapper'
    out.println '\t\tPUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;'
    out.println '\t\t&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;'
    out.println &quot;&lt;mapper namespace=\&quot;_namespace_\&quot;&gt;&quot;

    out.println &quot;&quot;
    out.println &quot;\t&lt;select id=\&quot;select${camelClassName}\&quot; parameterType=\&quot;\&quot; resultType=\&quot;\&quot;&gt;&quot;
    out.println &quot;\t\t/* Query ID : _namespace_.select${camelClassName} */&quot;
    out.println &quot;\t\tSELECT &quot;
    def index = 0;

    fields.each() {
        if (index != 0) {
            out.println &quot;\t\t\t,${Case.UPPER.apply(it.name)}&quot;
        } else {
            index = 1;
            out.println &quot;\t\t\t${Case.UPPER.apply(it.name)}&quot;
        }
    }
    out.println &quot;\t\tFROM ${Case.UPPER.apply(className)}&quot;
    out.println &quot;\t\tWHERE 1=1&quot;
    out.println &quot;\t&lt;/select&gt;&quot;


    out.println &quot;&quot;
    out.println &quot;\t&lt;insert id=\&quot;insert${camelClassName}\&quot; parameterType=\&quot;\&quot;&gt;&quot;
    out.println &quot;\t\t/* Query ID : _namespace_.insert${camelClassName} */&quot;
    out.println &quot;\t\tINSERT INTO ${Case.UPPER.apply(className)} (&quot;
    index = 0;
    fields.each() {
        if (index != 0) {
            out.println &quot;\t\t\t,${Case.UPPER.apply(it.name)}&quot;
        } else {
            index = 1;
            out.println &quot;\t\t\t${Case.UPPER.apply(it.name)}&quot;
        }
    }
    out.println &quot;\t\t) VALUES (&quot;
    index = 0;
    fields.each() {
        if (index != 0) {
            out.println &quot;\t\t\t,#{${it.camelName}}&quot;
        } else {
            index = 1;
            out.println &quot;\t\t\t#{${it.camelName}}&quot;
        }
    }
    out.println &quot;\t\t)&quot;
    out.println &quot;\t&lt;/insert&gt;&quot;

    out.println &quot;&quot;
    out.println &quot;\t&lt;update id=\&quot;update${camelClassName}\&quot; parameterType=\&quot;\&quot;&gt;&quot;
    out.println &quot;\t\t/* Query ID : _namespace_.update${camelClassName} */&quot;
    out.println &quot;\t\tUPDATE ${Case.UPPER.apply(className)} SET &quot;
    index = 0;

    fields.each() {
        if (index != 0) {
            out.println &quot;\t\t\t,${Case.UPPER.apply(it.name)} = #{${it.camelName}}&quot;
        } else {
            index = 1;
            out.println &quot;\t\t\t${Case.UPPER.apply(it.name)} = #{${it.camelName}}&quot;
        }
    }
    out.println &quot;\t\tWHERE 1=1&quot;
    out.println &quot;\t&lt;/update&gt;&quot;


    out.println '&lt;/mapper&gt;'
}

def calcFields(table) {
    DasUtil.getColumns(table).reduce([]) { fields, col -&gt;
        def spec = Case.LOWER.apply(col.getDasType().getSpecification())
        def typeStr = typeMapping.find { p, t -&gt; p.matcher(spec).find() }.value
        fields += [[
                           camelName: javaName(col.getName(), false),
                           name     : col.getName(),
                           type     : typeStr,
                           comment  : col.getComment(),
                           annos    : &quot;&quot;]]
    }
}

def javaName(str, capitalize) {
    def s = com.intellij.psi.codeStyle.NameUtil.splitNameIntoWords(str)
            .collect { Case.LOWER.apply(it).capitalize() }
            .join(&quot;&quot;)
            .replaceAll(/[^\p{javaJavaIdentifierPart}[_]]/, &quot;_&quot;)
    capitalize || s.length() == 1 ? s : Case.LOWER.apply(s[0]) + s[1..-1]
}
</div></section></section><section class="chapter"><h2 id="-pc3pdk_7" data-toc="-pc3pdk_7">💿 실행 및 결과</h2><section class="chapter"><h3 id="-pc3pdk_55" data-toc="-pc3pdk_55"><span class="emphasis" id="-pc3pdk_59"><span class="control" id="-pc3pdk_60">실행</span></span></h3><ol class="list _decimal" id="-pc3pdk_58" type="1"><li class="list__item" id="-pc3pdk_61"><p>Database ➡ tables ➡ Tools ➡ Scripted Extensions ➡ 생성한 Groovy 파일</p></li><li class="list__item" id="-pc3pdk_62"><p>저장할 위치 선택 </p><figure id="-pc3pdk_63"><img alt="20241205 101601" src="YT-Wiki/20241205_101601.png" title="20241205 101601" width="585" height="736"></figure></li></ol></section><section class="chapter"><h3 id="-pc3pdk_56" data-toc="-pc3pdk_56"><span class="emphasis" id="-pc3pdk_66"><span class="control" id="-pc3pdk_67">결과</span></span></h3><ol class="list _decimal" id="-pc3pdk_65" type="1"><li class="list__item" id="-pc3pdk_68"><p id="-pc3pdk_70">선택된 위치에 model, sql 폴더가 각각 생성된다. <figure id="-pc3pdk_71"><img alt="20241205 101701" src="YT-Wiki/20241205_101701.png" title="20241205 101701" width="209" height="136"></figure></p></li><li class="list__item" id="-pc3pdk_69"><p id="-pc3pdk_72">생성된 파일 예시</p><ul class="list _bullet" id="-pc3pdk_73"><li class="list__item" id="-pc3pdk_77"><p>VO (TbSample.java)</p></li></ul><div class="code-block" data-lang="java">
package _packageName_;

import lombok.*;
import com.fasterxml.jackson.annotation.JsonInclude;
import io.swagger.v3.oas.annotations.media.Schema;

@AllArgsConstructor(access = AccessLevel.PRIVATE)
@NoArgsConstructor
@Data
@Builder
@JsonInclude(JsonInclude.Include.NON_NULL)
public class TbSample {

    @Schema(description = &quot;Column 1&quot;, example = &quot;Column 1&quot;)
    private String colOne;

    @Schema(description = &quot;Column 2&quot;, example = &quot;Column 2&quot;)
    private String colTwo;

    @Schema(description = &quot;Column 3&quot;, example = &quot;Column 3&quot;)
    private String colThree;
}   
</div><ul class="list _bullet" id="-pc3pdk_75"><li class="list__item" id="-pc3pdk_78"><p>Mybatis XML Mapper (tb_sample.xml)</p></li></ul><div class="code-block" data-lang="markup">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE mapper
        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
&lt;mapper namespace=&quot;_namespace_&quot;&gt;

    &lt;select id=&quot;selectTbSample&quot; parameterType=&quot;&quot; resultType=&quot;&quot;&gt;
        /* Query ID : _namespace_.selectTbSample */
        SELECT 
            COL_ONE
            ,COL_TWO
            ,COL_THREE
        FROM TB_SAMPLE
        WHERE 1=1
    &lt;/select&gt;

    &lt;insert id=&quot;insertTbSample&quot; parameterType=&quot;&quot;&gt;
        /* Query ID : _namespace_.insertTbSample */
        INSERT INTO TB_SAMPLE (
            COL_ONE
            ,COL_TWO
            ,COL_THREE
        ) VALUES (
            #{colOne}
            ,#{colTwo}
            ,#{colThree}
        )
    &lt;/insert&gt;

    &lt;update id=&quot;updateTbSample&quot; parameterType=&quot;&quot;&gt;
        /* Query ID : _namespace_.updateTbSample */
        UPDATE TB_SAMPLE SET 
            COL_ONE = #{colOne}
            ,COL_TWO = #{colTwo}
            ,COL_THREE = #{colThree}
        WHERE 1=1
    &lt;/update&gt;
&lt;/mapper&gt;
</div></li></ol></section></section><section class="chapter"><h2 id="-pc3pdk_8" data-toc="-pc3pdk_8">👋 마치며</h2><p id="-pc3pdk_79">역시 <span class="emphasis" id="-pc3pdk_80">Jetbrains</span> 은 최고.. <span class="emphasis" id="-pc3pdk_81">IntelliJ</span> 를 사용하지 않을 수 없다. (<span id="-pc3pdk_82"><span class="text-line-through">학생계정으로 써서 미안</span></span>)</p></section><div class="last-modified">Last modified: 05 12월 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="postgre-session-kill.html" class="navigation-links__prev">🥑 세션 정보 확인 및 종료</a><a href="github-pages-start.html" class="navigation-links__next">⭐ Github Page 시작하기</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b518/app.js"></script><script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script async custom-element="amp-ad" src="https://cdn.ampproject.org/v0/amp-ad-0.1.js"></script>
<!--<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2327476184552798"
        crossorigin="anonymous"></script>-->
<script>

    let intervalSubject = "";
    let intervalAds = "";

    $(function(){
        intervalSubject = setInterval(subjectCallback, 300);
        intervalAds = setInterval(adsCallback, 300);
    });
    function subjectCallback(){
        if($(".wh-header__divider") != null && $(".wh-header__divider").length != 0){
            $(".wh-header__divider").append("<span style='border-left: 1px solid #eee;padding-left: 10px;font-size: 10px;'>똑바로 해 넌 정말</span>");
            clearInterval(intervalSubject);
        }
    }
    function adsCallback(){

        var ads = '<div style="text-align:center;margin-bottom:10px;"><amp-ad width="100vw" height="320"\n'
                  + '       type="adsense"\n'
                  + '       data-ad-client="ca-pub-2327476184552798"\n'
                  + '       data-ad-slot="1572389002"\n'
                  + '       data-auto-format="rspv"\n'
                  + '       data-full-width="">\n'
                  + '    <div overflow=""></div>\n'
                  + '  </amp-ad></div>';


        if($("footer") != null && $("footer").length != 0){
            $("footer").before(ads);
            clearInterval(intervalAds);
        }
    }

</script></body></html>